{"ast":null,"code":"var _jsxFileName = \"/Users/frank/workspace/dev_practice/front_end/src/components/Messager.jsx\",\n  _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport { Input } from \"antd\"; // Import Search from antd\nimport DisplayArea from './DisplayArea';\nimport { SendOutlined } from '@ant-design/icons';\nimport { Spin } from 'antd';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Search\n} = Input;\nexport default function Messager({\n  model\n}) {\n  _s();\n  const [querytxt, setquerytxt] = useState(\"\");\n  const [displaytxts, setdisplaytxts] = useState([]);\n  const [toScroll, setToScroll] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const componentWidth = '50%';\n  const handleAreaChange = e => {\n    setquerytxt(e.target.value);\n  };\n  const handleSubmit = async value => {\n    if (value !== \"\") {\n      try {\n        const appendedDisplay = [...displaytxts, {\n          \"role\": \"user\",\n          \"content\": value\n        }];\n        setdisplaytxts(appendedDisplay);\n        setquerytxt(\"\");\n        setToScroll(true);\n        setLoading(true);\n\n        // const res = await fetch(`http://127.0.0.1:3001/query?query=${encodeURIComponent(value)}`, { method: \"GET\" });\n        const res = await fetch('http://localhost:11434/api/chat', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            model: model,\n            messages: appendedDisplay,\n            stream: true\n          })\n        });\n        if (!res.ok) {\n          const errorMessage = await res.text();\n          throw new Error(`Error ${res.status}: ${errorMessage}`);\n        }\n        const reader = res.body.getReader();\n        const decoder = new TextDecoder(\"utf-8\");\n        let text_stream = \"\";\n        const processStream = async () => {\n          const {\n            done,\n            value\n          } = await reader.read();\n          if (done) {\n            return; // Stream completed\n          }\n          const chunk = decoder.decode(value, {\n            stream: true\n          });\n          try {\n            text_stream += JSON.parse(chunk).message.content;\n          } catch (error) {\n            console.log(chunk);\n          }\n          setdisplaytxts([...appendedDisplay, {\n            \"role\": \"assistant\",\n            \"content\": text_stream\n          }]);\n\n          // Continue reading the stream\n          setTimeout(processStream, 2000);\n          processStream();\n        };\n        processStream();\n        setLoading(false);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      alignItems: 'center',\n      height: '400vh'\n    },\n    children: [/*#__PURE__*/_jsxDEV(DisplayArea, {\n      displaytxts: displaytxts,\n      toScroll: toScroll,\n      setToScroll: setToScroll,\n      componentWidth: componentWidth,\n      style: {\n        backgroundColor: \"#F8F8F8\",\n        width: '50%',\n        // 调整宽度\n        height: '50vh',\n        // 调整高度\n        border: '1px solid #F8F8F8',\n        position: 'relative',\n        overflowY: \"scroll\"\n        // 移除 transform 属性\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Search, {\n      placeholder: \"Enter your query\",\n      loading: loading,\n      enterButton: loading ? /*#__PURE__*/_jsxDEV(Spin, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 40\n      }, this) : /*#__PURE__*/_jsxDEV(SendOutlined, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 51\n      }, this),\n      size: \"large\",\n      value: querytxt,\n      onChange: handleAreaChange,\n      onSearch: handleSubmit,\n      style: {\n        width: componentWidth,\n        height: '10%',\n        marginTop: '5%'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 80,\n    columnNumber: 9\n  }, this);\n}\n_s(Messager, \"9YnHBPtl4YCyn1lCkQjyK1DWRx4=\");\n_c = Messager;\nvar _c;\n$RefreshReg$(_c, \"Messager\");","map":{"version":3,"names":["useState","Input","DisplayArea","SendOutlined","Spin","jsxDEV","_jsxDEV","Search","Messager","model","_s","querytxt","setquerytxt","displaytxts","setdisplaytxts","toScroll","setToScroll","loading","setLoading","componentWidth","handleAreaChange","e","target","value","handleSubmit","appendedDisplay","res","fetch","method","headers","body","JSON","stringify","messages","stream","ok","errorMessage","text","Error","status","reader","getReader","decoder","TextDecoder","text_stream","processStream","done","read","chunk","decode","parse","message","content","error","console","log","setTimeout","style","display","flexDirection","justifyContent","alignItems","height","children","backgroundColor","width","border","position","overflowY","fileName","_jsxFileName","lineNumber","columnNumber","placeholder","enterButton","size","onChange","onSearch","marginTop","_c","$RefreshReg$"],"sources":["/Users/frank/workspace/dev_practice/front_end/src/components/Messager.jsx"],"sourcesContent":["import { useState } from \"react\";\nimport { Input } from \"antd\"; // Import Search from antd\nimport DisplayArea from './DisplayArea';\nimport { SendOutlined } from '@ant-design/icons';\nimport { Spin } from 'antd';\n\nconst { Search } = Input;\n\nexport default function Messager({ model }) {\n    const [querytxt, setquerytxt] = useState(\"\");\n    const [displaytxts, setdisplaytxts] = useState([]);\n    const [toScroll, setToScroll] = useState(false);\n    const [loading, setLoading] = useState(false);\n    const componentWidth = '50%';\n\n    const handleAreaChange = (e) => {\n        setquerytxt(e.target.value);\n    };\n\n    const handleSubmit = async (value) => {\n        if (value !== \"\") {\n            try {\n                const appendedDisplay = [...displaytxts, { \"role\": \"user\", \"content\": value }];\n                setdisplaytxts(appendedDisplay);\n                setquerytxt(\"\");\n                setToScroll(true);\n                setLoading(true);\n\n                // const res = await fetch(`http://127.0.0.1:3001/query?query=${encodeURIComponent(value)}`, { method: \"GET\" });\n                const res = await fetch('http://localhost:11434/api/chat', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({\n                        model: model,\n                        messages: appendedDisplay,\n                        stream: true\n                    }),\n                });\n\n                if (!res.ok) {\n                    const errorMessage = await res.text();\n                    throw new Error(`Error ${res.status}: ${errorMessage}`);\n                }\n\n                const reader = res.body.getReader();\n                const decoder = new TextDecoder(\"utf-8\");\n                let text_stream = \"\";\n\n                const processStream = async () => {\n                    const { done, value } = await reader.read();\n                    if (done) {\n                        return; // Stream completed\n                    }\n\n                    const chunk = decoder.decode(value, { stream: true });\n                    try {\n                        text_stream += JSON.parse(chunk).message.content;\n                    } catch (error) {\n                        console.log(chunk);\n                    }\n\n                    setdisplaytxts([...appendedDisplay, { \"role\": \"assistant\", \"content\": text_stream }]);\n\n                    // Continue reading the stream\n                    setTimeout(processStream, 2000);\n                    processStream();\n                };\n\n                processStream();\n                setLoading(false);\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    };\n\n    return (\n        <div style={{ \n                    display: 'flex', \n                    flexDirection: 'column', \n                    justifyContent: 'center', \n                    alignItems: 'center', \n                    height: '400vh'  \n                }}\n        >\n            <DisplayArea \n                displaytxts={displaytxts} \n                toScroll={toScroll} \n                setToScroll={setToScroll} \n                componentWidth={componentWidth}\n                style={{ \n                    backgroundColor: \"#F8F8F8\",\n                    width: '50%', // 调整宽度\n                    height: '50vh', // 调整高度\n                    border: '1px solid #F8F8F8', \n                    position: 'relative', \n                    overflowY: \"scroll\",\n                    // 移除 transform 属性\n                }}\n            />\n            <Search\n                placeholder=\"Enter your query\"\n                loading={loading}\n                enterButton={loading ? <Spin /> : <SendOutlined />}\n                size=\"large\"\n                value={querytxt}\n                onChange={handleAreaChange}\n                onSearch={handleSubmit}\n                style={{ width: componentWidth, height: '10%', marginTop: '5%' }}\n            />\n        </div>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}