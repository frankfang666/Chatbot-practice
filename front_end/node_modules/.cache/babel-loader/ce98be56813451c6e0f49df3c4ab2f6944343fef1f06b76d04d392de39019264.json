{"ast":null,"code":"var _jsxFileName = \"/Users/frank/workspace/dev_practice/front_end/src/components/Messager.jsx\",\n  _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport { Input } from \"antd\"; // Import Search from antd\nimport DisplayArea from './DisplayArea';\nimport { SendOutlined } from '@ant-design/icons';\nimport { Spin } from 'antd';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Search\n} = Input;\nexport default function Messager() {\n  _s();\n  const [querytxt, setquerytxt] = useState(\"\");\n  const [displaytxts, setdisplaytxts] = useState([]);\n  const [toScroll, setToScroll] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const componentWidth = '50%';\n  const handleAreaChange = e => {\n    setquerytxt(e.target.value);\n  };\n  const handleSubmit = async value => {\n    setLoading(true);\n    if (value !== \"\") {\n      try {\n        const appendedDisplay = [...displaytxts, {\n          \"text\": value,\n          \"source\": \"human\"\n        }];\n        setdisplaytxts(appendedDisplay);\n        setquerytxt(\"\");\n        setToScroll(true);\n\n        // const res = await fetch(`http://127.0.0.1:3001/query?query=${encodeURIComponent(value)}`, { method: \"GET\" });\n        const res = await fetch('http://localhost:11434/api/generate', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            model: 'qwen2:7b',\n            prompt: value,\n            stream: true\n          })\n        });\n        if (!res.ok) {\n          const errorMessage = await res.text();\n          throw new Error(`Error ${res.status}: ${errorMessage}`);\n        }\n        const reader = res.body.getReader();\n        const decoder = new TextDecoder(\"utf-8\");\n        let text_stream = \"\";\n        const processStream = async () => {\n          const {\n            done,\n            value\n          } = await reader.read();\n          if (done) {\n            return; // Stream completed\n          }\n          const chunk = decoder.decode(value, {\n            stream: true\n          });\n          text_stream += JSON.parse(chunk).response;\n          setdisplaytxts([...appendedDisplay, {\n            \"text\": text_stream,\n            \"source\": \"machine\"\n          }]);\n\n          // Continue reading the stream\n          setTimeout(processStream, 2000);\n          processStream();\n        };\n        processStream();\n        setLoading(false);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      alignItems: 'center',\n      height: '10vh'\n    },\n    children: [/*#__PURE__*/_jsxDEV(DisplayArea, {\n      displaytxts: displaytxts,\n      toScroll: toScroll,\n      setToScroll: setToScroll,\n      componentWidth: componentWidth,\n      style: {\n        backgroundColor: \"#F8F8F8\",\n        width: '50%',\n        height: '80%',\n        border: '1px solid #F8F8F8',\n        position: 'absolute',\n        marginLeft: '50%',\n        marginTop: '85%',\n        overflowY: \"scroll\",\n        transform: 'translate(-50%, -50%)'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Search, {\n      placeholder: \"Enter your query\",\n      loading: loading,\n      enterButton: loading ? /*#__PURE__*/_jsxDEV(Spin, {\n        style: {\n          fontSize: '16px'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 40\n      }, this) : /*#__PURE__*/_jsxDEV(SendOutlined, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 80\n      }, this),\n      size: \"large\",\n      value: querytxt,\n      onChange: handleAreaChange,\n      onSearch: handleSubmit,\n      style: {\n        width: componentWidth,\n        height: '10%',\n        marginTop: '90%'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 9\n  }, this);\n}\n_s(Messager, \"9YnHBPtl4YCyn1lCkQjyK1DWRx4=\");\n_c = Messager;\nvar _c;\n$RefreshReg$(_c, \"Messager\");","map":{"version":3,"names":["useState","Input","DisplayArea","SendOutlined","Spin","jsxDEV","_jsxDEV","Search","Messager","_s","querytxt","setquerytxt","displaytxts","setdisplaytxts","toScroll","setToScroll","loading","setLoading","componentWidth","handleAreaChange","e","target","value","handleSubmit","appendedDisplay","res","fetch","method","headers","body","JSON","stringify","model","prompt","stream","ok","errorMessage","text","Error","status","reader","getReader","decoder","TextDecoder","text_stream","processStream","done","read","chunk","decode","parse","response","setTimeout","error","console","log","style","display","flexDirection","justifyContent","alignItems","height","children","backgroundColor","width","border","position","marginLeft","marginTop","overflowY","transform","fileName","_jsxFileName","lineNumber","columnNumber","placeholder","enterButton","fontSize","size","onChange","onSearch","_c","$RefreshReg$"],"sources":["/Users/frank/workspace/dev_practice/front_end/src/components/Messager.jsx"],"sourcesContent":["import { useState } from \"react\";\nimport { Input } from \"antd\"; // Import Search from antd\nimport DisplayArea from './DisplayArea';\nimport { SendOutlined } from '@ant-design/icons';\nimport { Spin } from 'antd';\n\nconst { Search } = Input;\n\nexport default function Messager() {\n    const [querytxt, setquerytxt] = useState(\"\");\n    const [displaytxts, setdisplaytxts] = useState([]);\n    const [toScroll, setToScroll] = useState(false);\n    const [loading, setLoading] = useState(false);\n    const componentWidth = '50%';\n\n    const handleAreaChange = (e) => {\n        setquerytxt(e.target.value);\n    };\n\n    const handleSubmit = async (value) => {\n        setLoading(true);\n        if (value !== \"\") {\n            try {\n                const appendedDisplay = [...displaytxts, { \"text\": value, \"source\": \"human\" }];\n                setdisplaytxts(appendedDisplay);\n                setquerytxt(\"\");\n                setToScroll(true);\n\n                // const res = await fetch(`http://127.0.0.1:3001/query?query=${encodeURIComponent(value)}`, { method: \"GET\" });\n                const res = await fetch('http://localhost:11434/api/generate', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({\n                        model: 'qwen2:7b',\n                        prompt: value,\n                        stream: true\n                    }),\n                });\n\n                if (!res.ok) {\n                    const errorMessage = await res.text();\n                    throw new Error(`Error ${res.status}: ${errorMessage}`);\n                }\n\n                const reader = res.body.getReader();\n                const decoder = new TextDecoder(\"utf-8\");\n                let text_stream = \"\";\n\n                const processStream = async () => {\n                    const { done, value } = await reader.read();\n                    if (done) {\n                        return; // Stream completed\n                    }\n\n                    const chunk = decoder.decode(value, { stream: true });\n                    text_stream += JSON.parse(chunk).response;\n\n                    setdisplaytxts([...appendedDisplay, { \"text\": text_stream, \"source\": \"machine\" }]);\n\n                    // Continue reading the stream\n                    setTimeout(processStream, 2000);\n                    processStream();\n                };\n\n                processStream();\n                setLoading(false);\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    };\n\n    return (\n        <div style={{ \n                    display: 'flex', \n                    flexDirection: 'column', \n                    justifyContent: 'center', \n                    alignItems: 'center', \n                    height: '10vh'  \n                }}\n        >\n            <DisplayArea \n                displaytxts={displaytxts} \n                toScroll={toScroll} \n                setToScroll={setToScroll} \n                componentWidth={componentWidth}\n                style={{ \n                    backgroundColor: \"#F8F8F8\",\n                    width: '50%', \n                    height: '80%', \n                    border: '1px solid #F8F8F8', \n                    position: 'absolute', \n                    marginLeft: '50%', \n                    marginTop: '85%',\n                    overflowY: \"scroll\",\n                    transform: 'translate(-50%, -50%)' \n                }}\n            />\n            <Search\n                placeholder=\"Enter your query\"\n                loading={loading}\n                enterButton={loading ? <Spin style={{ fontSize: '16px' }} /> : <SendOutlined />}\n                size=\"large\"\n                value={querytxt}\n                onChange={handleAreaChange}\n                onSearch={handleSubmit}\n                style={{ width: componentWidth, height: '10%', marginTop: '90%' }}\n            />\n        </div>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}